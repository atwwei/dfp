{"version":3,"file":"dfp.js","sources":["../../src/lib/events.ts","../../src/lib/consts.ts","../../src/lib/actions.ts","../../src/lib/dfp.service.ts","../../src/lib/dfp-ad.directive.ts","../../src/lib/dfp.module.ts","../../src/public-api.ts","../../src/dfp.ts"],"sourcesContent":["class GptEvent {\n  serviceName!: string;\n  slot!: googletag.Slot;\n  constructor(event: googletag.events.Event) {\n    Object.assign(this, event);\n  }\n}\n\nexport class ImpressionViewableEvent extends GptEvent {}\n\nexport class SlotOnloadEvent extends GptEvent {}\n\nexport class SlotRenderEndedEvent extends GptEvent {\n  advertiserId?: number;\n  campaignId?: number;\n  creativeId?: number;\n  isEmpty!: boolean;\n  lineItemId?: number;\n  size!: googletag.SingleSize;\n  sourceAgnosticCreativeId?: number;\n  sourceAgnosticLineItemId?: number;\n}\n\nexport class SlotRequestedEvent extends GptEvent {}\n\nexport class SlotResponseReceived extends GptEvent {}\n\nexport class SlotVisibilityChangedEvent extends GptEvent {\n  inViewPercentage!: number;\n}\n\nexport type Event =\n  | ImpressionViewableEvent\n  | SlotRenderEndedEvent\n  | SlotRequestedEvent\n  | SlotOnloadEvent\n  | SlotResponseReceived\n  | SlotVisibilityChangedEvent;\n","export const GPT_SOURCE =\n  'https://securepubads.g.doubleclick.net/tag/js/gpt.js';\n\nexport const DELAY_TIME = 50;\n","class DfpAction {\n  slot: googletag.Slot;\n  constructor(slot: googletag.Slot) {\n    this.slot = slot;\n  }\n}\n\nexport class DfpAdDisplay extends DfpAction {}\n\nexport class DfpAdRefresh extends DfpAction {}\n\nexport type Action = DfpAdDisplay | DfpAdRefresh;\n","import { DOCUMENT, isPlatformBrowser } from '@angular/common';\nimport { Inject, Injectable, PLATFORM_ID } from '@angular/core';\n\nimport { Observable, Subject, timer } from 'rxjs';\nimport { buffer, filter, map, switchMap } from 'rxjs/operators';\n\nimport { GPT_SOURCE, DELAY_TIME } from './consts';\nimport {\n  Event,\n  ImpressionViewableEvent,\n  SlotOnloadEvent,\n  SlotRenderEndedEvent,\n  SlotRequestedEvent,\n  SlotResponseReceived,\n  SlotVisibilityChangedEvent,\n} from './events';\nimport { Action, DfpAdDisplay, DfpAdRefresh } from './actions';\nimport { ScriptOptions } from './types';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class DfpService {\n  private $queue = new Subject<Action>();\n\n  private $events = new Subject<Event>();\n  get events(): Observable<Event> {\n    return this.$events.asObservable();\n  }\n\n  constructor(\n    @Inject(PLATFORM_ID) private platformId: Record<string, unknown>,\n    @Inject(DOCUMENT) private document: Document,\n  ) {\n    if (isPlatformBrowser(this.platformId)) {\n      this.initializeGPT();\n      this.startActionQueue();\n      this.addEventListeners();\n    }\n  }\n\n  private initializeGPT() {\n    this.appendScript({ async: true, src: GPT_SOURCE });\n    window.googletag = window.googletag || { cmd: [] };\n  }\n\n  private startActionQueue() {\n    const displaySlots: googletag.Slot[] = [];\n\n    this.$queue\n      .pipe(\n        filter((act) => {\n          if (act instanceof DfpAdDisplay) {\n            displaySlots.push(act.slot);\n            return false;\n          }\n          return (\n            act instanceof DfpAdRefresh && displaySlots.indexOf(act.slot) === -1\n          );\n        }),\n        map((act) => act.slot),\n        buffer(this.$queue.pipe(switchMap(() => timer(DELAY_TIME * 2)))),\n      )\n      .subscribe((refreshSlots) => {\n        displaySlots.forEach((slot) => {\n          googletag.display(slot);\n        });\n        displaySlots.splice(0);\n        if (refreshSlots.length > 0) {\n          googletag.pubads().refresh(refreshSlots);\n        }\n      });\n  }\n\n  private addEventListeners() {\n    googletag.cmd.push(() => {\n      const pubads = googletag.pubads();\n      pubads.addEventListener('impressionViewable', (event) => {\n        this.$events.next(new ImpressionViewableEvent(event));\n      });\n      pubads.addEventListener('slotOnload', (event) => {\n        this.$events.next(new SlotOnloadEvent(event));\n      });\n      pubads.addEventListener('slotRenderEnded', (event) => {\n        this.$events.next(new SlotRenderEndedEvent(event));\n      });\n      pubads.addEventListener('slotRequested', (event) => {\n        this.$events.next(new SlotRequestedEvent(event));\n      });\n      pubads.addEventListener('slotResponseReceived', (event) => {\n        this.$events.next(new SlotResponseReceived(event));\n      });\n      pubads.addEventListener('slotVisibilityChanged', (event) => {\n        this.$events.next(new SlotVisibilityChangedEvent(event));\n      });\n    });\n  }\n\n  clear(elementIds?: string[]): void {\n    this.cmd(() => {\n      googletag.pubads().clear(this.getSlots(elementIds));\n    });\n  }\n\n  cmd(callback: () => void): void {\n    if (isPlatformBrowser(this.platformId)) {\n      googletag.cmd.push(callback);\n    }\n  }\n\n  destroySlots(elementIds?: string[]): void {\n    this.cmd(() => {\n      googletag.destroySlots(this.getSlots(elementIds));\n    });\n  }\n\n  getSlots(elementIds?: string[]): googletag.Slot[] | undefined {\n    let slots: googletag.Slot[] | undefined = undefined;\n    if (isPlatformBrowser(this.platformId)) {\n      if (googletag.apiReady && elementIds) {\n        return googletag\n          .pubads()\n          .getSlots()\n          .filter((slot) => {\n            return elementIds.indexOf(slot.getSlotElementId()) !== -1;\n          });\n      }\n    }\n    return slots;\n  }\n\n  refresh(\n    elementIds?: string[],\n    opt_options?: { changeCorrelator: boolean },\n  ): void {\n    this.cmd(() => {\n      googletag.pubads().refresh(this.getSlots(elementIds), opt_options);\n    });\n  }\n\n  queue(event: Action) {\n    this.$queue.next(event);\n  }\n\n  /**\n   * Append Script tag to parentNode\n   * @param options\n   * @param parentNode The default setting is document.head\n   * @returns\n   */\n  appendScript(\n    options: ScriptOptions,\n    parentNode?: Element,\n  ): HTMLScriptElement {\n    parentNode = parentNode || this.document.head;\n    const oldScript = options.id\n      ? parentNode.querySelector('#' + options.id)\n      : null;\n    const script = this.document.createElement('script');\n    Object.assign(script, options, {\n      type: 'text/javascript',\n    });\n    if (oldScript) {\n      parentNode.replaceChild(script, oldScript);\n    } else {\n      this.appendText('\\n', parentNode);\n      parentNode.appendChild(script);\n      this.appendText('\\n', parentNode);\n    }\n    return script;\n  }\n\n  appendText(data: string, parentNode?: Element): Text {\n    parentNode = parentNode || this.document.head;\n    const text = this.document.createTextNode(data);\n    parentNode.appendChild(text);\n    return text;\n  }\n}\n","/* eslint-disable @angular-eslint/no-conflicting-lifecycle */\nimport {\n  Directive,\n  DoCheck,\n  Inject,\n  Input,\n  OnChanges,\n  OnDestroy,\n  Optional,\n  PLATFORM_ID,\n  SimpleChanges,\n  TemplateRef,\n  ViewContainerRef,\n} from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { Subject, timer } from 'rxjs';\nimport { filter, switchMap, takeUntil } from 'rxjs/operators';\n\nimport { DELAY_TIME } from './consts';\nimport { DfpService } from './dfp.service';\nimport { DfpAdDisplay, DfpAdRefresh } from './actions';\nimport { DfpAd } from './types';\n\n@Directive({\n  selector: '[dfpAd]',\n})\nexport class DfpAdDirective implements DoCheck, OnChanges, OnDestroy {\n  private $destroy = new Subject();\n  private $update = new Subject();\n  private element?: HTMLElement;\n  private slot?: googletag.Slot;\n\n  @Input() set dfpAd(dfpAd: string | DfpAd) {\n    if (typeof dfpAd === 'string') {\n      this.unitPath = dfpAd;\n    } else {\n      Object.assign(this, dfpAd);\n    }\n  }\n  unitPath!: string;\n  @Input('dfpAdId') id?: string;\n  @Input('dfpAdSize') size?: googletag.GeneralSize;\n  @Input('dfpAdSizeMapping') sizeMapping?: googletag.SizeMappingArray;\n  @Input('dfpAdCategoryExclusion') categoryExclusion?: string | string[];\n  @Input('dfpAdClickUrl') clickUrl?: string;\n  @Input('dfpAdCollapseEmptyDiv') collapseEmptyDiv?:\n    | boolean\n    | [boolean, boolean];\n  @Input('dfpAdForceSafeFrame') forceSafeFrame?: boolean;\n  @Input('dfpAdSafeFrameConfig') safeFrameConfig?: googletag.SafeFrameConfig;\n  @Input('dfpAdTargeting') targeting?: Record<string, string | string[]>;\n  @Input('dfpAdAdsense') adsense?: Record<string, string>;\n  @Input('dfpAdContent') content?: string;\n\n  constructor(\n    private viewContainer: ViewContainerRef,\n    private templateRef: TemplateRef<unknown>,\n    private dfp: DfpService,\n    @Optional() router: Router,\n    @Inject(PLATFORM_ID) platformId: Object,\n  ) {\n    if (isPlatformBrowser(platformId)) {\n      this.$update\n        .pipe(\n          switchMap(() => timer(DELAY_TIME)),\n          takeUntil(this.$destroy),\n        )\n        .subscribe(() => {\n          this.dfp.cmd(() => this.display());\n        });\n\n      router &&\n        router.events\n          .pipe(\n            filter((event) => event instanceof NavigationEnd),\n            takeUntil(this.$destroy),\n          )\n          .subscribe((e) => {\n            this.$update.next();\n          });\n    }\n  }\n\n  display(): void {\n    if (this.element?.innerText?.match(/\\S+/)) {\n      return;\n    }\n\n    if (this.slot && this.id === this.element?.id) {\n      this.settings(this.slot);\n      this.dfp.queue(new DfpAdRefresh(this.slot));\n    } else {\n      this.destroy();\n      if ((this.slot = this.define())) {\n        googletag.enableServices();\n        if (this.size && this.content) {\n          googletag.content().setContent(this.slot, this.content);\n        } else {\n          this.dfp.queue(new DfpAdDisplay(this.slot));\n        }\n      } else {\n        this.clear();\n      }\n    }\n  }\n\n  ngDoCheck(): void {\n    if (this.element?.id && this.id !== this.element.id) {\n      this.id = this.element.id;\n      this.destroy();\n      this.create();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const change = changes['dfpAd'] || changes['id'] || changes['size'];\n    if (change && !change.isFirstChange()) {\n      this.clear();\n    }\n    this.create();\n  }\n\n  ngOnDestroy(): void {\n    this.$destroy.next();\n    this.clear();\n  }\n\n  private create(): void {\n    if (this.unitPath) {\n      if (!this.element) {\n        const view = this.viewContainer.createEmbeddedView(this.templateRef);\n        this.element = view.rootNodes[0];\n      }\n      this.$update.next();\n    } else {\n      this.clear();\n    }\n  }\n\n  private clear(): void {\n    this.viewContainer.clear();\n    this.element = undefined;\n    this.destroy();\n  }\n\n  private define(): googletag.Slot | undefined {\n    let slot: googletag.Slot | null;\n    const id = this.element?.id || this.id || '';\n    if (this.size) {\n      slot = googletag.defineSlot(this.unitPath, this.size, id);\n    } else {\n      slot = googletag.defineOutOfPageSlot(this.unitPath, id);\n    }\n    if (slot && this.element) {\n      this.id = this.element.id = id || slot.getSlotElementId();\n      return this.settings(slot);\n    }\n    return;\n  }\n\n  private destroy(): void {\n    if (this.slot) {\n      googletag.destroySlots([this.slot]);\n      this.slot = undefined;\n    }\n  }\n\n  private settings(slot: googletag.Slot): googletag.Slot {\n    if (this.size && this.content) {\n      slot.addService(googletag.content());\n    } else {\n      if (this.sizeMapping) {\n        slot.defineSizeMapping(this.sizeMapping);\n      }\n\n      slot.clearCategoryExclusions();\n      if (this.categoryExclusion) {\n        if (this.categoryExclusion instanceof Array) {\n          this.categoryExclusion.forEach((cat) =>\n            slot.setCategoryExclusion(cat),\n          );\n        } else {\n          slot.setCategoryExclusion(this.categoryExclusion);\n        }\n      }\n\n      if (typeof this.forceSafeFrame === 'boolean') {\n        slot.setForceSafeFrame(this.forceSafeFrame);\n      }\n\n      if (this.safeFrameConfig) {\n        slot.setSafeFrameConfig(this.safeFrameConfig);\n      }\n\n      slot.clearTargeting();\n      if (this.targeting) {\n        slot.updateTargetingFromMap(this.targeting);\n      }\n\n      if (this.collapseEmptyDiv instanceof Array) {\n        slot.setCollapseEmptyDiv(\n          this.collapseEmptyDiv[0],\n          this.collapseEmptyDiv[1],\n        );\n      } else if (typeof this.collapseEmptyDiv === 'boolean') {\n        slot.setCollapseEmptyDiv(this.collapseEmptyDiv);\n      }\n\n      if (this.clickUrl) {\n        slot.setClickUrl(this.clickUrl);\n      }\n\n      if (this.adsense) {\n        for (const key in this.adsense) {\n          slot.set(key, this.adsense[key]);\n        }\n      }\n\n      slot.addService(googletag.pubads());\n    }\n    return slot;\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { DfpAdDirective } from './dfp-ad.directive';\n\nconst DFP_DIRECTIVES = [DfpAdDirective];\n\n@NgModule({\n  declarations: DFP_DIRECTIVES,\n  exports: DFP_DIRECTIVES,\n})\nexport class DfpModule {}\n","/*\n * Public API Surface of dfp\n */\n\nexport {\n  ImpressionViewableEvent,\n  SlotRenderEndedEvent,\n  SlotRequestedEvent,\n  SlotOnloadEvent,\n  SlotResponseReceived,\n  SlotVisibilityChangedEvent,\n} from './lib/events';\nexport { DfpService } from './lib/dfp.service';\nexport { DfpModule } from './lib/dfp.module';\nexport { DfpAdDirective } from './lib/dfp-ad.directive';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}
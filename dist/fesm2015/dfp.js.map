{"version":3,"file":"dfp.js","sources":["../../src/lib/events.ts","../../src/lib/consts.ts","../../src/lib/actions.ts","../../src/lib/dfp.service.ts","../../src/lib/dfp-ad.directive.ts","../../src/lib/dfp.module.ts","../../src/public-api.ts","../../src/dfp.ts"],"sourcesContent":["class GptEvent {\n  serviceName!: string;\n  slot!: googletag.Slot;\n  constructor(event: googletag.events.Event) {\n    Object.assign(this, event);\n  }\n}\n\nexport class ImpressionViewableEvent extends GptEvent {}\n\nexport class SlotOnloadEvent extends GptEvent {}\n\nexport class SlotRenderEndedEvent extends GptEvent {\n  advertiserId?: number;\n  campaignId?: number;\n  creativeId?: number;\n  isEmpty!: boolean;\n  lineItemId?: number;\n  size!: googletag.SingleSize;\n  sourceAgnosticCreativeId?: number;\n  sourceAgnosticLineItemId?: number;\n}\n\nexport class SlotRequestedEvent extends GptEvent {}\n\nexport class SlotResponseReceived extends GptEvent {}\n\nexport class SlotVisibilityChangedEvent extends GptEvent {\n  inViewPercentage!: number;\n}\n\nexport type Event =\n  | ImpressionViewableEvent\n  | SlotRenderEndedEvent\n  | SlotRequestedEvent\n  | SlotOnloadEvent\n  | SlotResponseReceived\n  | SlotVisibilityChangedEvent;\n","export const GPT_SOURCE =\n  'https://securepubads.g.doubleclick.net/tag/js/gpt.js';\n\nexport const DELAY_TIME = 50;\n","class SlotRequest {\n  slot: googletag.Slot;\n  constructor(slot: googletag.Slot) {\n    this.slot = slot;\n  }\n}\n\nexport class DisplaySlot extends SlotRequest {}\n\nexport class RefreshSlot extends SlotRequest {}\n\nexport type Request = DisplaySlot | RefreshSlot;\n","import { DOCUMENT, isPlatformBrowser } from '@angular/common';\nimport { Inject, Injectable, PLATFORM_ID } from '@angular/core';\n\nimport { Observable, Subject, timer } from 'rxjs';\nimport { buffer, switchMap } from 'rxjs/operators';\n\nimport { GPT_SOURCE, DELAY_TIME } from './consts';\nimport {\n  Event,\n  ImpressionViewableEvent,\n  SlotOnloadEvent,\n  SlotRenderEndedEvent,\n  SlotRequestedEvent,\n  SlotResponseReceived,\n  SlotVisibilityChangedEvent,\n} from './events';\nimport { Request, DisplaySlot, RefreshSlot } from './actions';\nimport { ScriptOptions, DfpAd } from './types';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class DfpService {\n  private $singleRequest = new Subject<Request>();\n  private $events = new Subject<Event>();\n  get events(): Observable<Event> {\n    return this.$events.asObservable();\n  }\n\n  constructor(\n    @Inject(PLATFORM_ID) private platformId: Record<string, unknown>,\n    @Inject(DOCUMENT) private document: Document,\n  ) {\n    if (isPlatformBrowser(this.platformId)) {\n      this.init();\n    }\n  }\n\n  private init(): void {\n    // GPT\n    if (!window.googletag) {\n      this.appendScript({ async: true, src: GPT_SOURCE });\n      window.googletag = window.googletag || { cmd: [] };\n    }\n    // Single Request Queue\n    this.$singleRequest\n      .pipe(\n        buffer(\n          this.$singleRequest.pipe(switchMap(() => timer(DELAY_TIME * 2))),\n        ),\n      )\n      .subscribe((acts) => {\n        acts.forEach((act) => {\n          if (act instanceof DisplaySlot) {\n            googletag.display(act.slot);\n          } else if (act instanceof RefreshSlot) {\n            googletag.pubads().refresh([act.slot], { changeCorrelator: false });\n          }\n        });\n      });\n    // Event Listeners\n    googletag.cmd.push(() => {\n      const pubads = googletag.pubads();\n      pubads.addEventListener('impressionViewable', (event) => {\n        this.$events.next(new ImpressionViewableEvent(event));\n      });\n      pubads.addEventListener('slotOnload', (event) => {\n        this.$events.next(new SlotOnloadEvent(event));\n      });\n      pubads.addEventListener('slotRenderEnded', (event) => {\n        this.$events.next(new SlotRenderEndedEvent(event));\n      });\n      pubads.addEventListener('slotRequested', (event) => {\n        this.$events.next(new SlotRequestedEvent(event));\n      });\n      pubads.addEventListener('slotResponseReceived', (event) => {\n        this.$events.next(new SlotResponseReceived(event));\n      });\n      pubads.addEventListener('slotVisibilityChanged', (event) => {\n        this.$events.next(new SlotVisibilityChangedEvent(event));\n      });\n    });\n  }\n\n  define(ad: DfpAd): googletag.Slot | undefined {\n    let slot: googletag.Slot | null | undefined;\n    let id = ad.id || '';\n\n    if (id) {\n      const slotExists = this.getSlot(id);\n      if (slotExists?.getAdUnitPath() === ad.unitPath) {\n        slot = slotExists;\n      } else if (slotExists) {\n        this.destroy(slotExists);\n      }\n    }\n\n    if (!slot) {\n      if (ad.size) {\n        slot = googletag.defineSlot(ad.unitPath, ad.size, id);\n      } else {\n        slot = googletag.defineOutOfPageSlot(ad.unitPath, id);\n      }\n      if (!slot) {\n        return;\n      }\n    }\n\n    if (ad.size && ad.content) {\n      slot.addService(googletag.content());\n      googletag.enableServices();\n      googletag.content().setContent(slot, ad.content);\n    } else {\n      if (ad.sizeMapping) {\n        slot.defineSizeMapping(ad.sizeMapping);\n      }\n\n      slot.clearCategoryExclusions();\n      if (ad.categoryExclusion) {\n        if (ad.categoryExclusion instanceof Array) {\n          ad.categoryExclusion.forEach((cat) =>\n            slot?.setCategoryExclusion(cat),\n          );\n        } else {\n          slot.setCategoryExclusion(ad.categoryExclusion);\n        }\n      }\n\n      if (typeof ad.forceSafeFrame === 'boolean') {\n        slot.setForceSafeFrame(ad.forceSafeFrame);\n      }\n\n      if (ad.safeFrameConfig) {\n        slot.setSafeFrameConfig(ad.safeFrameConfig);\n      }\n\n      slot.clearTargeting();\n      if (ad.targeting) {\n        slot.updateTargetingFromMap(ad.targeting);\n      }\n\n      if (ad.collapseEmptyDiv instanceof Array) {\n        slot.setCollapseEmptyDiv(\n          ad.collapseEmptyDiv[0],\n          ad.collapseEmptyDiv[1],\n        );\n      } else if (typeof ad.collapseEmptyDiv === 'boolean') {\n        slot.setCollapseEmptyDiv(ad.collapseEmptyDiv);\n      }\n\n      if (ad.clickUrl) {\n        slot.setClickUrl(ad.clickUrl);\n      }\n\n      if (ad.adsense) {\n        for (const key in ad.adsense) {\n          slot.set(key, ad.adsense[key]);\n        }\n      }\n\n      slot.addService(googletag.pubads());\n      googletag.enableServices();\n    }\n\n    return slot;\n  }\n\n  display(slot: googletag.Slot): void {\n    if (googletag.pubads().isSRA()) {\n      this.$singleRequest.next(new DisplaySlot(slot));\n    } else {\n      googletag.display(slot);\n    }\n  }\n\n  refresh(slot: googletag.Slot): void {\n    if (googletag.pubads().isSRA()) {\n      this.$singleRequest.next(new RefreshSlot(slot));\n    } else {\n      googletag.pubads().refresh([slot]);\n    }\n  }\n\n  destroy(slot: googletag.Slot): void {\n    googletag.destroySlots([slot]);\n  }\n\n  /**\n   * Get the slot by element id\n   * @param elementId the slot element id\n   * @returns\n   */\n  getSlot(elementId: string): googletag.Slot | undefined {\n    return this.getSlots().find(\n      (slot) => elementId === slot.getSlotElementId(),\n    );\n  }\n\n  /**\n   * Get the list of slots associated with this service.\n   * @param elementIds the slot element id array.\n   * @returns\n   */\n  getSlots(elementIds?: string[]): googletag.Slot[] {\n    let slots: googletag.Slot[] = googletag.pubads().getSlots();\n    if (typeof elementIds !== 'undefined') {\n      slots = slots.filter(\n        (slot) => elementIds.indexOf(slot.getSlotElementId()) != -1,\n      );\n    }\n    return slots;\n  }\n\n  /**\n   * Use googletag.cmd.push() to execute the callback function.\n   * @param callback\n   */\n  cmd(callback: () => void): void {\n    if (isPlatformBrowser(this.platformId)) {\n      googletag.cmd.push(callback);\n    }\n  }\n\n  appendScript(\n    options: ScriptOptions,\n    parentNode?: Element,\n  ): HTMLScriptElement {\n    parentNode = parentNode || this.document.head;\n    const oldScript = options.id\n      ? parentNode.querySelector('#' + options.id)\n      : null;\n    const script = this.document.createElement('script');\n    Object.assign(script, options, { type: 'text/javascript' });\n    if (oldScript) {\n      parentNode.replaceChild(script, oldScript);\n    } else {\n      this.appendText('\\n', parentNode);\n      parentNode.appendChild(script);\n      this.appendText('\\n', parentNode);\n    }\n    return script;\n  }\n\n  appendText(data: string, parentNode?: Element): Text {\n    parentNode = parentNode || this.document.head;\n    const text = this.document.createTextNode(data);\n    parentNode.appendChild(text);\n    return text;\n  }\n}\n","/* eslint-disable @angular-eslint/no-conflicting-lifecycle */\nimport {\n  Directive,\n  DoCheck,\n  Inject,\n  Input,\n  OnChanges,\n  OnDestroy,\n  Optional,\n  PLATFORM_ID,\n  SimpleChanges,\n  TemplateRef,\n  ViewContainerRef,\n} from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { NavigationEnd, Router } from '@angular/router';\n\nimport { Subject, timer } from 'rxjs';\nimport { filter, switchMap, takeUntil } from 'rxjs/operators';\n\nimport { DELAY_TIME } from './consts';\nimport { DfpService } from './dfp.service';\nimport { DfpAd } from './types';\n\n@Directive({\n  selector: '[dfpAd]',\n})\nexport class DfpAdDirective implements DoCheck, OnChanges, OnDestroy {\n  private $destroy = new Subject();\n  private $update = new Subject();\n  private element?: HTMLElement;\n  private slot?: googletag.Slot;\n\n  @Input() set dfpAd(dfpAd: string | DfpAd) {\n    if (typeof dfpAd === 'string') {\n      this.unitPath = dfpAd;\n    } else {\n      Object.assign(this, dfpAd);\n    }\n  }\n  unitPath!: string;\n  @Input('dfpAdId') id?: string;\n  @Input('dfpAdSize') size?: googletag.GeneralSize;\n  @Input('dfpAdSizeMapping') sizeMapping?: googletag.SizeMappingArray;\n  @Input('dfpAdCategoryExclusion') categoryExclusion?: string | string[];\n  @Input('dfpAdClickUrl') clickUrl?: string;\n  @Input('dfpAdCollapseEmptyDiv') collapseEmptyDiv?:\n    | boolean\n    | [boolean, boolean];\n  @Input('dfpAdForceSafeFrame') forceSafeFrame?: boolean;\n  @Input('dfpAdSafeFrameConfig') safeFrameConfig?: googletag.SafeFrameConfig;\n  @Input('dfpAdTargeting') targeting?: Record<string, string | string[]>;\n  @Input('dfpAdAdsense') adsense?: Record<string, string>;\n  @Input('dfpAdContent') content?: string;\n\n  constructor(\n    private viewContainer: ViewContainerRef,\n    private templateRef: TemplateRef<unknown>,\n    private dfp: DfpService,\n    @Optional() private router: Router,\n    @Inject(PLATFORM_ID) platformId: Object,\n  ) {\n    if (isPlatformBrowser(platformId)) {\n      this.init();\n    }\n  }\n\n  private init(): void {\n    this.$update\n      .pipe(\n        switchMap(() => timer(DELAY_TIME)),\n        takeUntil(this.$destroy),\n      )\n      .subscribe(() => {\n        this.dfp.cmd(() => this.display());\n      });\n\n    this.router &&\n      this.router.events\n        .pipe(\n          filter((event) => event instanceof NavigationEnd),\n          takeUntil(this.$destroy),\n        )\n        .subscribe(() => {\n          this.$update.next();\n        });\n  }\n\n  create(): void {\n    if (this.unitPath) {\n      if (!this.element) {\n        const view = this.viewContainer.createEmbeddedView(this.templateRef);\n        this.element = view.rootNodes[0];\n      }\n      this.$update.next();\n    } else {\n      this.clear();\n    }\n  }\n\n  display(): void {\n    if (!this.element || this.element?.innerText?.match(/\\S+/)) {\n      return;\n    }\n\n    if (this.slot && this.id === this.element.id) {\n      this.dfp.define(Object.assign({}, this));\n      this.dfp.refresh(this.slot);\n    } else {\n      this.destroy();\n      const id = this.element.id || this.id;\n      if ((this.slot = this.dfp.define(Object.assign({}, this, { id: id })))) {\n        this.id = this.element.id = id || this.slot.getSlotElementId();\n        this.dfp.display(this.slot);\n      } else {\n        this.clear();\n      }\n    }\n  }\n\n  clear(): void {\n    this.viewContainer.clear();\n    this.element = undefined;\n    this.destroy();\n  }\n\n  destroy(): void {\n    if (this.slot) {\n      this.dfp.destroy(this.slot);\n      this.slot = undefined;\n    }\n  }\n\n  ngDoCheck(): void {\n    if (this.element?.id && this.id !== this.element.id) {\n      this.id = this.element.id;\n      this.destroy();\n      this.create();\n    }\n  }\n\n  ngOnChanges(changes: SimpleChanges): void {\n    const change = changes['dfpAd'] || changes['id'] || changes['size'];\n    if (change && !change.isFirstChange()) {\n      this.clear();\n    }\n    this.create();\n  }\n\n  ngOnDestroy(): void {\n    this.$destroy.next();\n    this.clear();\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { DfpAdDirective } from './dfp-ad.directive';\n\nconst DFP_DIRECTIVES = [DfpAdDirective];\n\n@NgModule({\n  declarations: DFP_DIRECTIVES,\n  exports: DFP_DIRECTIVES,\n})\nexport class DfpModule {}\n","/*\n * Public API Surface of dfp\n */\n\nexport {\n  ImpressionViewableEvent,\n  SlotRenderEndedEvent,\n  SlotRequestedEvent,\n  SlotOnloadEvent,\n  SlotResponseReceived,\n  SlotVisibilityChangedEvent,\n} from './lib/events';\nexport { ScriptOptions, DfpAd } from './lib/types';\nexport { DfpService } from './lib/dfp.service';\nexport { DfpModule } from './lib/dfp.module';\nexport { DfpAdDirective } from './lib/dfp-ad.directive';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}